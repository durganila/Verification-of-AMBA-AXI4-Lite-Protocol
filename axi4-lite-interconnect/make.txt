all: clean lib compile opt run_randomtest run_deterministictest

help:
	@echo -e "\nMakeInfo: This is a MakeFile running\nMakeInfo: Following commands present--\n"   
	@echo -e "	--	all		 				-> Simulates design and runs all related commands\n"
	@echo -e "	--	clean	 				-> Cleans all simulation related files\n"
	@echo -e "	--	lib		 				-> Forms work directory\n"
	@echo -e "	--	compile	 				-> Compiles testbench and DUT files\n"
	@echo -e "	--	run_randomtest		 	-> Runs simulation with random tests\n"
	@echo -e "	--	run_deterministictest 	-> Runs simulation with deterministic tests\n"

clean:
	rm -rf transcript vsim.wlf modelsim.ini func_cover_report_random.txt func_cover_report_deter.txt work
	@echo -e "\nMakeInfo: All simulation related files cleared\n"

lib: 
	vlib work
	vmap work work 
	@echo -e "\nMakeInfo: Work directory created!\n"
	
compile:
	vlog axi_lite_pkg.sv
	vlog DUT/axi_lite_master.sv
	vlog DUT/axi_lite_slave.sv
	vlog axi_lite_if.sv
	vlog TB/axi_env.sv
	vlog TB/driver.sv
	vlog TB/generator.sv
	vlog TB/monitor.sv
	vlog TB/scoreboard.sv
	vlog TB/testFactory.sv
	vlog TB/transaction.sv
	vlog TB/axi_lite_coverage.sv
	vlog TB/top.sv
	vlog TB/TestTypes/deterministic_tests.sv
	vlog TB/TestTypes/fully_random_test.sv
	@echo -e "\nMakeInfo: Compilation successful!\n"
	
opt:
	vopt +acc +cover=bcesxf top -o top_optimized 
	
run_randomtest:
	@echo -e "\nMakeInfo: Running Simulation with Coverage......!\n"
	vsim -voptargs="+acc" +IS_DEBUG_MODE=0 +TEST_TYPE=full_random +NUM_TRANSACTIONS=1000 top_optimized -do "add wave -r sim:/top/*; run -all; coverage report -output func_cover_report_random.txt -srcfile=* -detail -annotate -directive -cvg -codeAll; quit"

run_deterministictest:	
	@echo -e "\nMakeInfo: Running Simulation with Coverage......!\n"
	vsim -voptargs="+acc" +IS_DEBUG_MODE=0 +TEST_TYPE=deterministic +NUM_TRANSACTIONS=1000 top_optimized -do "add wave -r sim:/top/*; run -all; coverage report -output func_cover_report_deter.txt -srcfile=* -detail -annotate -directive -cvg -codeAll; quit"
	
	#vsim -voptargs="+acc" +IS_DEBUG_MODE=0 +TEST_TYPE=full_random +NUM_TRANSACTIONS=1000 top_optimized -do "add wave -r sim:/top/*; run -all; coverage report -output func_cover_report_random.ucdb -srcfile=* -detail -annotate -directive -cvg -codeAll; quit"
	
	#vsim -voptargs="+acc" +IS_DEBUG_MODE=0 +TEST_TYPE=deterministic +NUM_TRANSACTIONS=1000 top_optimized -do "add wave -r sim:/top/*; run -all; coverage report -output func_cover_report_deter.ucdb -srcfile=* -detail -annotate -directive -cvg -codeAll; quit"
	
	#vcover cvg func_cover_report_random.txt func_cover_report_random.ucdb
	#vcover cvg func_cover_report_deter.txt func_cover_report_deter.ucdb
	
	#vcover report -details result.ucdb
	
	


